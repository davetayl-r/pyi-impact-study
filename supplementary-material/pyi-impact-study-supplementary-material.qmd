---
title: "A Hybrid type-1 Implementation-Effectiveness Study of an Accommodation and Support Intervention for Care Leavers in Australia: Using Propensity Score Matching to Examine Homelessness Outcomes --- supplementary material"
author: 
  - name: David Taylor
    affiliation: Monash University
    orcid: 0000-0001-8801-7488
  - name: Jessica Roberts
    affiliation: Monash University 
    orcid:
  - name: Vanessa Rose
    affiliation: Centre for Evidence and Implementation
    orcid:
  - name: Alex Gyani
    affiliation: Behavioural Insights Team
    orcid: 
  - name: Aron Shlonsky
    affiliation: Monash University
    orcid: 0000-0001-8096-726X
date: 2025-02-14
citation:
  doi: "TBD"
  url: https://davetayl-r.github.io/pyi-impact-study
bibliography: pyi-impact-study-supplementary-material.bib
csl: apa-6th-edition.csl
link-citations: true
format: 
  html: 
    number-sections: true
    highlight-style: ayu
    css: styles.css
tbl-cap-location: "top"
fig-cap-location: "top"
---

```{r}
#| echo: false
#| message: false
#| name: pyi-supplementary-material-global-options

# load required packages in groundhog framework
library("groundhog")

required_packages <- c(
  "quarto",
  "tidyverse",
  "ggplot2",
  "tinytable",
  "kableExtra",
  "readxl",
  "showtext",
  "halfmoon")
groundhog.library(required_packages, "2025-01-01")

# ensure required fonts are loaded
font_add_google("Roboto", "roboto")
showtext_auto()
showtext_opts(dpi = 300)

# set knitr defaults
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  cache = FALSE
)
```

# About

This page contains supplementary material for a study titled *"A Hybrid type-1 Implementation-Effectiveness Study of an Accommodation and Support Intervention for Care Leavers in Australia: Using Propensity Score Matching to Examine Homelessness Outcomes"*.

The following information is provided here:

[**Reporting Standards:**](#sec-reporting-standards)

-   [*STROBE checklist*](#sec-strobe-checklist) --- details of how this paper meets the STROBE reporting guidelines for observational studies.

-   [*Propensity Score Methods reporting checklist*](#sec-matching-checklist) --- details how this paper fulfils the guidelines on PSM reporting suggested by @thoemmes2011systematicreviewpropensity.

[**Supplementary methodology:**](#sec-methodology%7D)

-   [*Variables from administrative data*](#sec-variables) --- defines the variables used in our matching and outcome models.

-   [*Matching diagnostic tests*](#sec-match-diagnostic) --- includes the diagnostic visualisations we used to assess covariate balance and common support.

[**Supplementary results:**](#sec-results)

-   [*Treatment effect results*](#sec-treatment-effect) --- includes the full results of our ATT estimates

-   [*Heterogenous treatment effects*](#sec-hts) --- includes figures depicting the results of our analysis of heterogenous treatment effects

-   [*Subgroup analysis*](#sec-subgroup-analysis) --- includes the full results of our subgroup analysis estimating conditional ATT by sex, Aboriginal status and housing vulnerability

-   [*Sensitivity analysis*](#sec-sensitivity-analysis) --- includes results of our tipping point analysis for assess for the existence of unmeasured confounding

The code to produce this supplementary material, along with the analysis code for this review is available in a [GitHub repository](https://github.com/davetayl-r/pyi-impact-study).

# Reporting Standards {#sec-reporting-standards}

## STROBE checklist {#sec-strobe-checklist}

The STROBE checklist [@elm2007strengtheningreportingobservational] with RECORD extension [@benchimol2015reportingstudiesconducted] is included in @tbl-pyi-strobe-checklist.

| Item No. | STROBE Items | Location in Manuscript | RECORD Items | Location in Manuscript |
|----|----|----|----|----|
| 1 | \(a\) Indicate the studyâ€™s design with a commonly used term in the title or the abstract (b) Provide in the abstract an informative and balanced summary of what was done and what was found |  | RECORD 1.1: The type of data used should be specified in the title or abstract. When possible, the name of the databases used should be included. <br> RECORD 1.2: If applicable, the geographic region and timeframe within which the study took place should be reported in the title or abstract. <br> RECORD 1.3: If linkage between databases was conducted for the study, this should be clearly stated in the title or abstract. |  |
| 2 | Explain the scientific background and rationale for the investigation being reported |  |  |  |
| 3 | State specific objectives, including any prespecified hypotheses |  |  |  |
| 4 | Present key elements of study design early in the paper |  |  |  |
| 5 | Describe the setting, locations, and relevant dates, including periods of recruitment, exposure, follow-up, and data collection |  |  |  |
| 6 | \(a\) Cohort study - Give the eligibility criteria, and the sources and methods of selection of participants. Describe methods of follow-up <br> Case-control study - Give the eligibility criteria, and the sources and methods of case ascertainment and control selection. Give the rationale for the choice of cases and controls <br> Cross-sectional study - Give the eligibility criteria, and the sources and methods of selection of participants <br> (b) Cohort study - For matched studies, give matching criteria and number of exposed and unexposed <br> Case-control study - For matched studies, give matching criteria and the number of controls per case |  | RECORD 6.1: The methods of study population selection (such as codes or algorithms used to identify subjects) should be listed in detail. If this is not possible, an explanation should be provided. <br> RECORD 6.2: Any validation studies of the codes or algorithms used to select the population should be referenced. If validation was conducted for this study and not published elsewhere, detailed methods and results should be provided. <br> RECORD 6.3: If the study involved linkage of databases, consider use of a flow diagram or other graphical display to demonstrate the data linkage process, including the number of individuals with linked data at each stage. |  |
| 7 | Clearly define all outcomes, exposures, predictors, potential confounders, and effect modifiers. Give diagnostic criteria, if applicable. |  | RECORD 7.1: A complete list of codes and algorithms used to classify exposures, outcomes, confounders, and effect modifiers should be provided. If these cannot be reported, an explanation should be provided. |  |
| 8 | For each variable of interest, give sources of data and details of methods of assessment (measurement). Describe comparability of assessment methods if there is more than one group |  |  |  |
| 9 | Describe any efforts to address potential sources of bias |  |  |  |
| 10 | Explain how the study size was arrived at |  |  |  |
| 11 | Explain how quantitative variables were handled in the analyses. If applicable, describe which groupings were chosen, and why |  |  |  |
| 12 | \(a\) Describe all statistical methods, including those used to control for confounding <br> (b) Describe any methods used to examine subgroups and interactions <br> (c) Explain how missing data were addressed <br> (d) Cohort study - If applicable, explain how loss to follow-up was addressed <br> Case-control study - If applicable, explain how matching of cases and controls was addressed <br> Cross-sectional study - If applicable, describe analytical methods taking account of sampling strategy <br> (e) Describe any sensitivity analyses |  | RECORD 12.1: Authors should describe the extent to which the investigators had access to the database population used to create the study population. <br> RECORD 12.2: Authors should provide information on the data cleaning methods used in the study. <br> RECORD 12.3: State whether the study included person-level, institutional-level, or other data linkage across two or more databases. The methods of linkage and methods of linkage quality evaluation should be provided. |  |
| 13 | \(a\) Report the numbers of individuals at each stage of the study (e.g., numbers potentially eligible, examined for eligibility, confirmed eligible, included in the study, completing follow-up, and analysed) <br> (b) Give reasons for non-participation at each stage. <br> (c) Consider use of a flow diagram |  | RECORD 13.1: Describe in detail the selection of the persons included in the study (i.e., study population selection) including filtering based on data quality, data availability and linkage. The selection of included persons can be described in the text and/or by means of the study flow diagram. |  |

: STROBE checklist with RECORD extension {#tbl-pyi-strobe-checklist}

## Propensity Score Methods reporting checklist {#sec-matching-checklist}

The checklist of reporting guidelines by Thoemmes and Kim [-@thoemmes2011systematicreviewpropensity] is detailed in @tbl-pyi-psm-checklist.

| \# | Characteristic | Location in manuscript |
|----|----|----|
| 1 | List of all covariates that were collected (with reliabilities) |  |
| 2 | List of all covariates that were used to estimate the propensity score |  |
| 3 | Method that was used to determine set of covariates used for estimation (e.g., nonparsimonious model, predetermined significance threshold) |  |
| 4 | Inclusion of polynomial or interaction terms |  |
| 5 | Estimation method for propensity scores (e.g., logistic regression, regression trees) |  |
| 6 | Conditioning strategy (e.g., matching, stratification, weighting) |  |
| 7 | Region of common support (histograms, ranges) |  |
| 8 | Details on matching scheme, if applicable |  |
| 8.1 | Type of matching algorithm (e.g., nearest neighbor, optimal, full, kernel) |  |
| 8.2 | Number of treated and control units that were matched with each other (e.g., 1:1, 1:many) |  |
| 8.3 | Matching with or without replacement |  |
| 8.4 | Caliper width, if applicable | Not applicable |
| 9 | Details on stratification, if applicable | Not applicable |
| 9.1 | Number of strata | Not applicable |
| 9.2 | Strategy to define strata (equal proportions, minimize variance) |  |
| 10 | Details on weighting, if applicable |  |
| 10.1 | Type of weights used (inverse probability weights, odd weights) |  |
| 10.2 | Distribution of weights, reporting of unusually large weights |  |
| 11 | Sample size before and after conditioning; report effective sample size if weights are used |  |
| 12 | Standardized difference before and after matching on the propensity score and all covariates, potentially also on interactions and quadratic terms |  |
| 13 | Point estimate of treatment effect and associated standard error |  |
| 14 | Inclusion of covariates in outcome model |  |

: Reporting guidelines for studies using Propensity Score Methods by Thoemmes & Kim (2011) {#tbl-pyi-psm-checklist}

# Supplementary methodology {#sec-methodology}

## Variables from administrative data {sec-variables}

We have defined the variables that we used in our matching and outcome models in @tbl-var-defs below.

| Variable | Definition | Source |
|----|----|----|
| `male` | Binary indicator for male | ChildStory |
| `aboriginal` | Binary indicator for Aboriginal and Torres Strait Islander status ever recorded | ChildStory |
| `eligible_residential_care_placement` | Binary indicator for whether an individual was in a placement type recorded as "Residential Care" during their eligibility window | ChildStory |
| `eligible_time_in_care` | Binary indicator for whether an individual had spent 12 or more months in OOHC by either the start or end of their eligibility window | ChildStory |
| `eligible_placement_instability` | Binary indicator capturing placement instability through either: (1) More than 3 placements (lasting 30+ days) by either the start or end of eligibility window, OR (2) Any placement (lasting 30+ days) in either 6 months before eligibility window, 12 months before eligibility window, or during eligibility window itself, OR (3) Being in independent living arrangements in their last placement | ChildStory |
| `eligible_permanent_placement` | Binary indicator for whether an individual was in a placement with purpose recorded as "Permanent Care" during their eligibility window | ChildStory |
| `eligible_kinship_care_placement` | Binary indicator for whether an individual was in a kinship care placement during their eligibility window | ChildStory |
| `parental_responsibility_minister_eligiblity_period` | Binary indicator for whether the Minister had parental responsibility for the individual during their eligibility window | ChildStory |
| `any_housing_spell_before_18` | Binary indicator for whether an individual had any contact with SHS for 'housing reasons' between their 16th and 18th birthday | CIMS |
| `in_housing_spell_on_date_18` | Binary indicator for being in a SHS spell on their 18th birthday | CIMS |
| `in_housing_spell_on_date_19` | Binary indicator for being in a SHS spell on their 19th birthday | CIMS |
| `new_housing_spell_between_18_19` | Binary indicator for any new SHS spell between 18th and 19th birthday | CIMS |
| `new_ongoing_housing_spell_between_18_19` | Binary indicator for either continuing or new SHS spell between 18th and 19th birthday | CIMS |
| `new_unsheltered_homelessness_between_18_19` | Binary indicator for new spell of unsheltered homelessness between 18th and 19th birthday, where unsheltered homelessness is defined as either: (1) current residential dwelling is a tent, improvised dwelling, no dwelling (in the open), or motor vehicle, OR (2) residential dwelling in last week was a tent, improvised dwelling, no dwelling (in the open), or motor vehicle, OR (3) reported sleeping rough or in non-conventional accommodation in the last week | CIMS |
| `new_ongoing_unsheltered_homelessness_between_18_19` | Binary indicator for a new or continuing spell of unsheltered homelessness between 18th and 19th birthday, where unsheltered homelessness is defined as either: (1) current residential dwelling is a tent, improvised dwelling, no dwelling (in the open), or motor vehicle, OR (2) residential dwelling in last week was a tent, improvised dwelling, no dwelling (in the open), or motor vehicle, OR (3) reported sleeping rough or in non-conventional accommodation in the last week | CIMS |
| `new_short_term_accommodation_required_between_18_19` | Binary indicator for new spell requiring short-term accommodation between 18th and 19th birthday (based on Short_Term_Accom_ind in CIMS) | CIMS |
| `new_ongoing_short_term_accommodation_required_between_18_19` | Binary indicator for either continuing or new spell requiring short-term accommodation between 18th and 19th birthday (based on Short_Term_Accom_ind in CIMS) | CIMS |
| `count_total_spells_18_19` | Count of total number of distinct SHS spells between 18th and 19th birthday | CIMS |
| `time_in_housing_support_18_19` | Total days in SHS between 18th and 19th birthday | CIMS |

: Variable definitions and sources {#tbl-var-defs}

# Supplementary results {#sec-results}

## Matching diagnostic tests {#sec-match-diagnostic}

### Assessing sample balance

@fig-pyi-love-plot presents a love plot, a diagnostic tool for assessing covariate balance before and after matching. It displays the standardized mean differences (SMDs) for each covariate included in the matching model, providing a scale-independent measure of balance that is unaffected by sample size. Covariate balance is essential for causal inference, as it ensures that intervention and comparison groups are sufficiently comparable, reducing sensitivity to model misspecification and improving the validity of treatment effect estimates. Prior to matching, six of nine covariates exceeded the commonly recommended threshold of 0.1 SMD, indicating poor balance; however, both matching methods improved balance substantially, with full matching achieving excellent balance across all covariates.

```{r}
#| label: fig-pyi-love-plot
#| echo: false
#| fig-cap: Distribution of propensity scores under different matching specifications
#| cache: true

love_plot_data_location <- "../supplementary-material/inputs/love_plot_data.rds"
love_plot_data <- readRDS(love_plot_data_location)

love_plot_data |>
  select(
    -pyi_flag
  ) |>
  mutate(
    variable = case_when(
      variable == "male" ~ "Male",                                                
      variable == "aboriginal" ~ "Aboriginal or Torres Strait Islander",                                      
      variable == "eligible_residential_care_placement" ~ "Residential care placement during eligibility period",                 
      variable == "eligible_time_in_care" ~ "Twelve months or more in out-of-home care",                 
      variable == "eligible_placement_instability" ~ "History of out-of-home care placement instability",               
      variable == "eligible_permanent_placement" ~ "Permanent care placement during eligibility period",                        
      variable == "eligible_kinship_care_placement" ~ "Kinship care placement during eligibility period",                     
      variable == "permanent_responsibility_minister_eligiblity_period" ~ "Parental responsibility of the Minister during eligibility period",
      variable == "any_housing_spell_before_18" ~ "Spell in homelessness services before 18th birthday",
      ),
    variable = factor(
      variable,
        levels = c(
          "Parental responsibility of the Minister during eligibility period",
          "Kinship care placement during eligibility period",
          "Spell in homelessness services before 18th birthday",
          "Permanent care placement during eligibility period",
          "History of out-of-home care placement instability",
          "Twelve months or more in out-of-home care",                
          "Residential care placement during eligibility period",                                          
          "Aboriginal or Torres Strait Islander", 
          "Male"),
        ordered = TRUE
    ),
      method = case_when(
        method == "observed" ~ "Difference between intervention and comparison groups\nbefore matching",
        method == "full_match_data" ~ "Difference between intervention and comparison groups\nafter full matching",
        method == "nn_match_data" ~ "Difference between intervention and comparison groups\nafter nearest neighbour matching"
    ),
      smd = abs(smd)
  ) |>
  group_by(
    method
  ) |>
  arrange(
    method, 
    variable
  ) |>
  ungroup() |>
  ggplot() +
    aes(
      x = smd,
      y = forcats::fct_rev(variable),
      colour = method
    ) +
  geom_vline(
    xintercept = 0,
    colour = "#000000"
  ) +  
  geom_vline(
    xintercept = 0.1,
    linetype = 2,
    colour = "#404145"
  ) +
  geom_point(
    aes(
      shape = method
    ),
    size = 2
  ) +
  geom_path(
    aes(group = method),
    alpha = 0.5
  ) +
  scale_y_discrete(
    labels = scales::label_wrap(35)
  ) +
  scale_colour_manual(
    values = c(
      "Difference between intervention and comparison groups\nbefore matching" = "#F1A208", 
      "Difference between intervention and comparison groups\nafter full matching" = "#005377",
      "Difference between intervention and comparison groups\nafter nearest neighbour matching" = "#06A77D"
    )
  ) +
  labs(
    y = "",
    x = "Standardised Mean Difference"
  ) +
  theme(
    legend.position = "bottom",
    legend.direction = "vertical",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

### Assessing common support

The common support assumption requires that the probability of receiving treatment conditional on covariates $X$ lies strictly between 0 and 1: $0 < P(D=1|X) < 1$ where $D$ is the treatment indicator and $X$ represents the vector of covariates used for matching. This condition requires that there is overlap in the distribution of propensity scores between those who receive the intervention and comparison across the range of scores, in order for a counterfactual to be valid [@heckman1997matchingeconometricevaluation]. We assessed this visually using a balance plot (@fig-pyi-halfmoon-plot), which shows the distribution of propensity scores for the intervention and comparison groups under both matching specifications. The plot shows that both specifications achieve substantial overlap in the propensity score distributions between individuals in the intervention and comparison samples, suggesting the analysis meets the common support assumption.

```{r}
#| label: fig-pyi-halfmoon-plot
#| echo: false
#| fig-cap: Distribution of propensity scores under different matching specifications
#| cache: true

balance_plot_data_location <- "../supplementary-material/inputs/balance_plot_data.rds"
balance_plot_data <- readRDS(balance_plot_data_location)

balance_plot_data |>
  mutate(
    matching_specification = case_when(
      matching_specification == "Full" ~ "Full matching",
      matching_specification == "Nearest Neighbour" ~ "Nearest neighbour matching"
    )
  ) |>
  ggplot() +
  aes(
    x = ps_score
  ) +
  geom_mirror_histogram(
    aes(
      group = factor(pyi_flag), 
    ),
    binwidth = 0.04
  ) +
  geom_mirror_histogram(
    aes(
      fill = factor(pyi_flag), 
      weight = weights,
    ),
    binwidth = 0.04
  ) +
  facet_wrap(
    ~matching_specification
  ) +
  scale_fill_manual(
    values = c("0" = "#EE4266", "1" = "#0EAD69"),
    labels = c("Comparison", "Intervention")
  ) +
  labs(
    x = "Propensity Score",
    y = "Frequency"
  ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

## Treatment effect results {#sec-treatment-effect}

```{r}
#| label: tbl-pyi-att-full-match
#| tbl-cap: "ATT estimates from full matching specification" 
#| echo: false
#| cache: false

# read data
combined_att_results_full_match_file_location <- "../supplementary-material/inputs/combined_att_results.csv"
combined_att_results_full_match <- read_csv(
  combined_att_results_full_match_file_location,
  show_col_types = FALSE)

# subset and organise data
combined_att_results_full_match_table_data <- combined_att_results_full_match |>
  select(
    metrics,
    ends_with(
      "full_match")
  ) |>
  filter(
    !metrics == "Model family",
    !metrics == "Link function",
    !metrics == "Estimated Potential Outcomes:",
    !metrics == "Treatment Effects:",
    !metrics == "Risk Difference:",
    !metrics == "Relative Risk:",
    !metrics == "Odds Ratio:", 
    !metrics == "Mean Difference:",
    !metrics == "Standardised Mean Difference:"
  )

# hide column names
colnames(combined_att_results_full_match_table_data) <- rep("", ncol(combined_att_results_full_match))

# create table
combined_att_results_full_match_table <- combined_att_results_full_match_table_data |>
  tt() |>
  # add link function
  group_tt(
    j = list(
      "Link function:" = 1,
      "Logit" = 2,
      "Logit" = 3,
      "Logit" = 4,
      "Logit" = 5,
      "Logit" = 6,
      "Logit" = 7,
      "Logit" = 8,
      "Logit" = 9,
      "Log" = 10,
      "Identity" = 11)
  ) |>
  # add model family
  group_tt(
    j = list(
      "Model family:" = 1,
      "Quasibinomial" = 2,
      "Quasibinomial" = 3,
      "Quasibinomial" = 4,
      "Quasibinomial" = 5,
      "Quasibinomial" = 6,
      "Quasibinomial" = 7,
      "Quasibinomial" = 8,
      "Quasibinomial" = 9,
      "Poisson" = 10,
      "Linear" = 11)
  ) |>
  # add outcomes
  group_tt(
    j = list(
      "In homelessness spell on 18th birthday" = 2,                                                                  
      "In homelessness spell on 19th birthday" = 3,                                                                  
      "New homelessness spell between 18th & 19th birthday" = 4,                                                     
      "New or ongoing homelessness spell between 18th & 19th birthday" = 5,                                                     
      "New unsheltered homelessness spell between 18th and 19th birthday" = 6,                                       
      "New or ongoing unsheltered homelessness spell between 18th and 19th birthday" = 7,                            
      "In new homelessness spell that requires housing assistance between 18th & 19th birthday" = 8,                 
      "In new or ongoing homelessness spell that requires short term accommodation between 18th & 19th birthday" = 9,
      "Number of distinct homelessness spells between 18th and 19th birthday" = 10,  
      "Days in homelessness spell between 18th and 19th birthday" = 11)
  ) |>
  # add table subheadings
  group_tt(
    i = list(
      "Estimated Potential Outcomes:" = 1,
      "Treatment Effects:" = 3,
      "Risk Difference:" = 3,
      "Relative Risk:" = 6,
      "Odds Ratio:" = 9, 
      "Mean Difference:" = 12,
      "Standardised Mean Difference:" = 15
    )
  ) |>
  # style first column of table
  style_tt(
    i = c(-2,2,3,6,7,8,10,11,12,14,15,16,18,19,20,22,23,24,25),
    j = 1, 
    bold = FALSE,
    italic = TRUE
  ) |>
  # style table sub-headings
  style_tt(
    i = c(1,4,5,9,13,17,21),
    j = 1, 
    bold = TRUE,
    fontsize = 1.1,
    color = "#000000"
  ) |>
  # replace NA values with empty cells
  format_tt(
    replace = ""
  ) |>
  # align calls to centre
  style_tt(j = 2:11, align = "c") 

# render table
combined_att_results_full_match_table
```

```{r}
#| label: tbl-pyi-att-nn-match
#| tbl-cap: "ATT estimates from nearest neighbour matching specification" 
#| echo: false
#| cache: false

# read data
combined_att_results_nn_match_file_location <- "../supplementary-material/inputs/combined_att_results.csv"
combined_att_results_nn_match <- read_csv(
  combined_att_results_nn_match_file_location,
  show_col_types = FALSE) 

combined_att_results_nn_match_table_data <- combined_att_results_nn_match |>
  # subset and organise data
  select(
    metrics,
    ends_with(
      "nn_match")
  ) |>
  filter(
    !metrics == "Model family",
    !metrics == "Link function",
    !metrics == "Estimated Potential Outcomes:",
    !metrics == "Treatment Effects:",
    !metrics == "Risk Difference:",
    !metrics == "Relative Risk:",
    !metrics == "Odds Ratio:", 
    !metrics == "Mean Difference:",
    !metrics == "Standardised Mean Difference:"
  )

# hide column names
colnames(combined_att_results_nn_match_table_data) <- rep("", ncol(combined_att_results_nn_match))

# create table
combined_att_results_nn_match_table <- combined_att_results_nn_match_table_data |>
  tt() |>
  # add link function
  group_tt(
    j = list(
      "Link function:" = 1,
      "Logit" = 2,
      "Logit" = 3,
      "Logit" = 4,
      "Logit" = 5,
      "Logit" = 6,
      "Logit" = 7,
      "Logit" = 8,
      "Logit" = 9,
      "Log" = 10,
      "Identity" = 11)
  ) |>
  # add model family
  group_tt(
    j = list(
      "Model family:" = 1,
      "Quasibinomial" = 2,
      "Quasibinomial" = 3,
      "Quasibinomial" = 4,
      "Quasibinomial" = 5,
      "Quasibinomial" = 6,
      "Quasibinomial" = 7,
      "Quasibinomial" = 8,
      "Quasibinomial" = 9,
      "Poisson" = 10,
      "Linear" = 11)
  ) |>
  # add outcomes
  group_tt(
    j = list(
      "In homelessness spell on 18th birthday" = 2,                                                                  
      "In homelessness spell on 19th birthday" = 3,                                                                  
      "New homelessness spell between 18th & 19th birthday" = 4,                                                     
      "New or ongoing homelessness spell between 18th & 19th birthday" = 5,                                                     
      "New unsheltered homelessness spell between 18th and 19th birthday" = 6,                                       
      "New or ongoing unsheltered homelessness spell between 18th and 19th birthday" = 7,                            
      "In new homelessness spell that requires housing assistance between 18th & 19th birthday" = 8,                 
      "In new or ongoing homelessness spell that requires short term accommodation between 18th & 19th birthday" = 9,
      "Number of distinct homelessness spells between 18th and 19th birthday" = 10,  
      "Days in homelessness spell between 18th and 19th birthday" = 11)
  ) |>
  # add table subheadings
  group_tt(
    i = list(
      "Estimated Potential Outcomes:" = 1,
      "Treatment Effects:" = 3,
      "Risk Difference:" = 3,
      "Relative Risk:" = 6,
      "Odds Ratio:" = 9, 
      "Mean Difference:" = 12,
      "Standardised Mean Difference:" = 15
    )
  ) |>
  # style first column of table
  style_tt(
    i = c(-2,2,3,6,7,8,10,11,12,14,15,16,18,19,20,22,23,24,25),
    j = 1, 
    bold = FALSE,
    italic = TRUE
  ) |>
  # style table sub-headings
  style_tt(
    i = c(1,4,5,9,13,17,21),
    j = 1, 
    bold = TRUE,
    fontsize = 1.1,
    color = "#000000"
  ) |>
  # replace NA values with empty cells
  format_tt(
    replace = ""
  ) |>
  # align calls to centre
  style_tt(j = 2:11, align = "c") 

# render table
combined_att_results_nn_match_table
```

## Heterogeneous treatment effects {#sec-hts}

### HTE x 'In homelessness spell on 18th birthday'

```{r}
#| label: fig-pyi-hte-in-housing-spell-on-date-18
#| fig-cap: "Heterogenous treatment effects for 'In homelessness spell on 18th birthday'" 
#| echo: false
#| cache: true

hte_in_housing_spell_on_date_18_file_location <- "../supplementary-material/inputs/hte_in_housing_spell_on_date_18_plot_data.rds"
hte_in_housing_spell_on_date_18_plot_data <- readRDS(hte_in_housing_spell_on_date_18_file_location)

hte_in_housing_spell_on_date_18_plot_data |>
  mutate(
    effect_type = case_when(
      effect_type == "CATT x Aboriginal" ~ "CATT x Aboriginal status",
      effect_type == "CATT x Last placement: kinship care" ~ "CATT x Eligible placement: kinship care",
      effect_type == "CATT x Last placement: residential care" ~ "CATT x Eligible placement: residential care",
      TRUE ~ effect_type),
    effect_type = factor(
      effect_type,
        levels = c(
          "ATT",
          "CATT x Sex",
          "CATT x Aboriginal status",
          "CATT x Housing Vulnerability",
          "CATT x Eligible placement: residential care",
          "CATT x History of placement instability",
          "CATT x Eligible placement: kinship care"),
          ordered = TRUE)
  ) |>
  ggplot() +
  aes(
    x = distance,
    y = treatment_effect,
    colour = factor(pyi_flag)
  ) +
  geom_point(
    alpha = 0.5
  ) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  geom_hline(
    yintercept = 0,
    linetype = 2,
    colour = "#404145"
  ) +
  facet_grid(
    matching_specification ~ effect_type,
    labeller = labeller(
      effect_type = label_wrap_gen(width = 12),
      matching_specification = label_wrap_gen(width = 20)
    )
  ) +
  scale_colour_manual(
    values = c("0" = "#EE4266", "1" = "#0EAD69"),
    labels = c("Comparison", "Intervention")
  ) +
  labs(
    y = "Estimated Individual Treatment Effect",
    x = "Propensity Score"
  ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

### HTE x 'In homelessness spell on 19th birthday'

```{r}
#| label: fig-pyi-hte-in-housing-spell-on-date-19
#| fig-cap: "Heterogenous treatment effects for 'In homelessness spell on 19th birthday'" 
#| echo: false
#| cache: true

hte_in_housing_spell_on_date_19_file_location <- "../supplementary-material/inputs/hte_in_housing_spell_on_date_19_plot_data.rds"
hte_in_housing_spell_on_date_19_plot_data <- readRDS(hte_in_housing_spell_on_date_19_file_location)

hte_in_housing_spell_on_date_19_plot_data |>
  mutate(
    effect_type = case_when(
      effect_type == "CATT x Aboriginal" ~ "CATT x Aboriginal status",
      effect_type == "CATT x Last placement: kinship care" ~ "CATT x Eligible placement: kinship care",
      effect_type == "CATT x Last placement: residential care" ~ "CATT x Eligible placement: residential care",
      TRUE ~ effect_type),
    effect_type = factor(
      effect_type,
      levels = c(
        "ATT",
        "CATT x Sex",
        "CATT x Aboriginal status",
        "CATT x Housing Vulnerability",
        "CATT x Eligible placement: residential care",
        "CATT x History of placement instability",
        "CATT x Eligible placement: kinship care"),
      ordered = TRUE)
  ) |>
  ggplot() +
  aes(
    x = distance,
    y = treatment_effect,
    colour = factor(pyi_flag)
  ) +
  geom_point(
    alpha = 0.5
  ) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  geom_hline(
    yintercept = 0,
    linetype = 2,
    colour = "#404145"
  ) +
  facet_grid(
    matching_specification ~ effect_type,
    labeller = labeller(
      effect_type = label_wrap_gen(width = 12),
      matching_specification = label_wrap_gen(width = 20)
    )
  ) +
  scale_colour_manual(
    values = c("0" = "#EE4266", "1" = "#0EAD69"),
    labels = c("Comparison", "Intervention")
  ) +
  labs(
    y = "Estimated Individual Treatment Effect",
    x = "Propensity Score"
  ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

### HTE x 'New homelessness spell between 18th & 19th birthday'

```{r}
#| label: fig-pyi-hte-new-housing-spell-between-18-19
#| fig-cap: "Heterogenous treatment effects for 'New homelessness spell between 18th & 19th birthday'" 
#| echo: false
#| cache: true

hte_new_housing_spell_between_18_19_file_location <- "../supplementary-material/inputs/hte_new_housing_spell_between_18_19_plot_data.rds" 
hte_new_housing_spell_between_18_19_plot_data <- readRDS(hte_new_housing_spell_between_18_19_file_location)

hte_new_housing_spell_between_18_19_plot_data |>
  mutate(
    effect_type = case_when(
      effect_type == "CATT x Aboriginal" ~ "CATT x Aboriginal status",
      effect_type == "CATT x Last placement: kinship care" ~ "CATT x Eligible placement: kinship care",
      effect_type == "CATT x Last placement: residential care" ~ "CATT x Eligible placement: residential care",
      TRUE ~ effect_type),
    effect_type = factor(
      effect_type,
      levels = c(
        "ATT",
        "CATT x Sex",
        "CATT x Aboriginal status",
        "CATT x Housing Vulnerability",
        "CATT x Eligible placement: residential care",
        "CATT x History of placement instability",
        "CATT x Eligible placement: kinship care"),
      ordered = TRUE)
  ) |>
  ggplot() +
  aes(
    x = distance,
    y = treatment_effect,
    colour = factor(pyi_flag)
  ) +
  geom_point(
    alpha = 0.5
  ) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  geom_hline(
    yintercept = 0,
    linetype = 2,
    colour = "#404145"
  ) +
  facet_grid(
    matching_specification ~ effect_type,
    labeller = labeller(
      effect_type = label_wrap_gen(width = 12),
      matching_specification = label_wrap_gen(width = 20)
    )
  ) +
  scale_colour_manual(
    values = c("0" = "#EE4266", "1" = "#0EAD69"),
    labels = c("Comparison", "Intervention")
  ) +
  labs(
    y = "Estimated Individual Treatment Effect",
    x = "Propensity Score"
  ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

### HTE x 'New or ongoing homelessness spell between 18th & 19th birthday'

```{r}
#| label: fig-pyi-hte-new-ongoing-housing-spell-between-18-19
#| fig-cap: "Heterogenous treatment effects for 'New or ongoing homelessness spell between 18th & 19th birthday'" 
#| echo: false
#| cache: true

hte_any_housing_spell_between_18_19_file_location <- "../supplementary-material/inputs/hte_any_housing_spell_between_18_19_plot_data.rds"                             
hte_any_housing_spell_between_18_19_plot_data <- readRDS(hte_any_housing_spell_between_18_19_file_location) 

hte_any_housing_spell_between_18_19_plot_data |>
  mutate(
    effect_type = case_when(
      effect_type == "CATT x Aboriginal" ~ "CATT x Aboriginal status",
      effect_type == "CATT x Last placement: kinship care" ~ "CATT x Eligible placement: kinship care",
      effect_type == "CATT x Last placement: residential care" ~ "CATT x Eligible placement: residential care",
      TRUE ~ effect_type),
    effect_type = factor(
      effect_type,
      levels = c(
        "ATT",
        "CATT x Sex",
        "CATT x Aboriginal status",
        "CATT x Housing Vulnerability",
        "CATT x Eligible placement: residential care",
        "CATT x History of placement instability",
        "CATT x Eligible placement: kinship care"),
      ordered = TRUE)
  ) |>
  ggplot() +
  aes(
    x = distance,
    y = treatment_effect,
    colour = factor(pyi_flag)
  ) +
  geom_point(
    alpha = 0.5
  ) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  geom_hline(
    yintercept = 0,
    linetype = 2,
    colour = "#404145"
  ) +
  facet_grid(
    matching_specification ~ effect_type,
    labeller = labeller(
      effect_type = label_wrap_gen(width = 12),
      matching_specification = label_wrap_gen(width = 20)
    )
  ) +
  scale_colour_manual(
    values = c("0" = "#EE4266", "1" = "#0EAD69"),
    labels = c("Comparison", "Intervention")
  ) +
  labs(
    y = "Estimated Individual Treatment Effect",
    x = "Propensity Score"
  ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

### HTE x 'New unsheltered homelessness spell between 18th and 19th birthday'

```{r}
#| label: fig-pyi-hte-new-unsheltered-homelessness-between-18-19
#| fig-cap: "Heterogenous treatment effects for 'New unsheltered homelessness spell between 18th and 19th birthday'" 
#| echo: false
#| cache: true

hte_new_unsheltered_homelessness_between_18_19_file_location <- "../supplementary-material/inputs/hte_new_unsheltered_homelessness_between_18_19_plot_data.rds"        
hte_new_unsheltered_homelessness_between_18_19_plot_data <- readRDS(hte_new_unsheltered_homelessness_between_18_19_file_location)

hte_new_unsheltered_homelessness_between_18_19_plot_data |>
  mutate(
    effect_type = case_when(
      effect_type == "CATT x Aboriginal" ~ "CATT x Aboriginal status",
      effect_type == "CATT x Last placement: kinship care" ~ "CATT x Eligible placement: kinship care",
      effect_type == "CATT x Last placement: residential care" ~ "CATT x Eligible placement: residential care",
      TRUE ~ effect_type),
    effect_type = factor(
      effect_type,
      levels = c(
        "ATT",
        "CATT x Sex",
        "CATT x Aboriginal status",
        "CATT x Housing Vulnerability",
        "CATT x Eligible placement: residential care",
        "CATT x History of placement instability",
        "CATT x Eligible placement: kinship care"),
      ordered = TRUE)
  ) |>
  ggplot() +
  aes(
    x = distance,
    y = treatment_effect,
    colour = factor(pyi_flag)
  ) +
  geom_point(
    alpha = 0.5
  ) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  geom_hline(
    yintercept = 0,
    linetype = 2,
    colour = "#404145"
  ) +
  facet_grid(
    matching_specification ~ effect_type,
    labeller = labeller(
      effect_type = label_wrap_gen(width = 12),
      matching_specification = label_wrap_gen(width = 20)
    )
  ) +
  scale_colour_manual(
    values = c("0" = "#EE4266", "1" = "#0EAD69"),
    labels = c("Comparison", "Intervention")
  ) +
  labs(
    y = "Estimated Individual Treatment Effect",
    x = "Propensity Score"
  ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

### HTE x 'New or ongoing unsheltered homelessness spell between 18th and 19th birthday'

```{r}
#| label: fig-pyi-hte-new-ongoing-unsheltered-homelessness-between-18-19
#| fig-cap: "Heterogenous treatment effects for 'New or ongoing unsheltered homelessness spell between 18th and 19th birthday'" 
#| echo: false
#| cache: true

hte_new_ongoing_unsheltered_homelessness_between_18_19_file_location <- "../supplementary-material/inputs/hte_new_ongoing_unsheltered_homelessness_between_18_19_plot_data.rds"  
hte_new_ongoing_unsheltered_homelessness_between_18_19_plot_data <- readRDS(hte_new_ongoing_unsheltered_homelessness_between_18_19_file_location)

hte_new_ongoing_unsheltered_homelessness_between_18_19_plot_data |>
  mutate(
    effect_type = case_when(
      effect_type == "CATT x Aboriginal" ~ "CATT x Aboriginal status",
      effect_type == "CATT x Last placement: kinship care" ~ "CATT x Eligible placement: kinship care",
      effect_type == "CATT x Last placement: residential care" ~ "CATT x Eligible placement: residential care",
      TRUE ~ effect_type),
    effect_type = factor(
      effect_type,
      levels = c(
        "ATT",
        "CATT x Sex",
        "CATT x Aboriginal status",
        "CATT x Housing Vulnerability",
        "CATT x Eligible placement: residential care",
        "CATT x History of placement instability",
        "CATT x Eligible placement: kinship care"),
      ordered = TRUE)
  ) |>
  ggplot() +
  aes(
    x = distance,
    y = treatment_effect,
    colour = factor(pyi_flag)
  ) +
  geom_point(
    alpha = 0.5
  ) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  geom_hline(
    yintercept = 0,
    linetype = 2,
    colour = "#404145"
  ) +
  facet_grid(
    matching_specification ~ effect_type,
    labeller = labeller(
      effect_type = label_wrap_gen(width = 12),
      matching_specification = label_wrap_gen(width = 20)
    )
  ) +
  scale_colour_manual(
    values = c("0" = "#EE4266", "1" = "#0EAD69"),
    labels = c("Comparison", "Intervention")
  ) +
  labs(
    y = "Estimated Individual Treatment Effect",
    x = "Propensity Score"
  ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

### HTE x 'In new homelessness spell that requires short term accommodation between 18th & 19th birthday'

```{r}
#| label: fig-pyi-hte-new-short-term-accommodation-required-between-18-19
#| fig-cap: "Heterogenous treatment effects for 'In new homelessness spell that requires short term accommodation between 18th & 19th birthday'" 
#| echo: false
#| cache: true

hte_new_short_term_accommodation_required_between_18_19_file_location <- "../supplementary-material/inputs/hte_new_short_term_accommodation_required_between_18_19_plot_data.rds"       
hte_new_short_term_accommodation_required_between_18_19_plot_data <- readRDS(hte_new_short_term_accommodation_required_between_18_19_file_location)

hte_new_short_term_accommodation_required_between_18_19_plot_data |>
  mutate(
    effect_type = case_when(
      effect_type == "CATT x Aboriginal" ~ "CATT x Aboriginal status",
      effect_type == "CATT x Last placement: kinship care" ~ "CATT x Eligible placement: kinship care",
      effect_type == "CATT x Last placement: residential care" ~ "CATT x Eligible placement: residential care",
      TRUE ~ effect_type),
    effect_type = factor(
      effect_type,
      levels = c(
        "ATT",
        "CATT x Sex",
        "CATT x Aboriginal status",
        "CATT x Housing Vulnerability",
        "CATT x Eligible placement: residential care",
        "CATT x History of placement instability",
        "CATT x Eligible placement: kinship care"),
      ordered = TRUE)
  ) |>
  ggplot() +
  aes(
    x = distance,
    y = treatment_effect,
    colour = factor(pyi_flag)
  ) +
  geom_point(
    alpha = 0.5
  ) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  geom_hline(
    yintercept = 0,
    linetype = 2,
    colour = "#404145"
  ) +
  facet_grid(
    matching_specification ~ effect_type,
    labeller = labeller(
      effect_type = label_wrap_gen(width = 12),
      matching_specification = label_wrap_gen(width = 20)
    )
  ) +
  scale_colour_manual(
    values = c("0" = "#EE4266", "1" = "#0EAD69"),
    labels = c("Comparison", "Intervention")
  ) +
  labs(
    y = "Estimated Individual Treatment Effect",
    x = "Propensity Score"
  ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

### HTE x 'In new or ongoing homelessness spell that requires short term accommodation between 18th & 19th birthday'

```{r}
#| label: fig-pyi-hte-new-ongoing-short-term-accommodation-required-between-18-19
#| fig-cap: "Heterogenous treatment effects for 'In new or ongoing homelessness spell that requires short term accommodation between 18th & 19th birthday'" 
#| echo: false
#| cache: true

hte_new_ongoing_short_term_accommodation_required_between_18_19_file_location <- "../supplementary-material/inputs/hte_new_ongoing_short_term_accommodation_required_between_18_19_plot_data.rds"
hte_new_ongoing_short_term_accommodation_required_between_18_19_plot_data <- readRDS(hte_new_ongoing_short_term_accommodation_required_between_18_19_file_location)

hte_new_ongoing_short_term_accommodation_required_between_18_19_plot_data |>
  mutate(
    effect_type = case_when(
      effect_type == "CATT x Aboriginal" ~ "CATT x Aboriginal status",
      effect_type == "CATT x Last placement: kinship care" ~ "CATT x Eligible placement: kinship care",
      effect_type == "CATT x Last placement: residential care" ~ "CATT x Eligible placement: residential care",
      TRUE ~ effect_type),
    effect_type = factor(
      effect_type,
      levels = c(
        "ATT",
        "CATT x Sex",
        "CATT x Aboriginal status",
        "CATT x Housing Vulnerability",
        "CATT x Eligible placement: residential care",
        "CATT x History of placement instability",
        "CATT x Eligible placement: kinship care"),
      ordered = TRUE)
  ) |>
  ggplot() +
  aes(
    x = distance,
    y = treatment_effect,
    colour = factor(pyi_flag)
  ) +
  geom_point(
    alpha = 0.5
  ) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  geom_hline(
    yintercept = 0,
    linetype = 2,
    colour = "#404145"
  ) +
  facet_grid(
    matching_specification ~ effect_type,
    labeller = labeller(
      effect_type = label_wrap_gen(width = 12),
      matching_specification = label_wrap_gen(width = 20)
    )
  ) +
  scale_colour_manual(
    values = c("0" = "#EE4266", "1" = "#0EAD69"),
    labels = c("Comparison", "Intervention")
  ) +
  labs(
    y = "Estimated Individual Treatment Effect",
    x = "Propensity Score"
  ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

### HTE x 'Number of distinct homelessness spells between 18th and 19th birthday'

```{r}
#| label: fig-pyi-hte-count-total-spells-18-19
#| fig-cap: "Heterogenous treatment effects for 'Number of distinct homelessness spells between 18th and 19th birthday'" 
#| echo: false
#| cache: true

hte_count_total_spells_18_19_file_location <- "../supplementary-material/inputs/hte_count_total_spells_18_19_plot_data.rds"                       
hte_count_total_spells_18_19_plot_data <- readRDS(hte_count_total_spells_18_19_file_location)

hte_count_total_spells_18_19_plot_data |>
  mutate(
    effect_type = case_when(
      effect_type == "CATT x Aboriginal" ~ "CATT x Aboriginal status",
      effect_type == "CATT x Last placement: kinship care" ~ "CATT x Eligible placement: kinship care",
      effect_type == "CATT x Last placement: residential care" ~ "CATT x Eligible placement: residential care",
      TRUE ~ effect_type),
    effect_type = factor(
      effect_type,
      levels = c(
        "ATT",
        "CATT x Sex",
        "CATT x Aboriginal status",
        "CATT x Housing Vulnerability",
        "CATT x Eligible placement: residential care",
        "CATT x History of placement instability",
        "CATT x Eligible placement: kinship care"),
      ordered = TRUE)
  ) |>
  ggplot() +
  aes(
    x = distance,
    y = treatment_effect,
    colour = factor(pyi_flag)
  ) +
  geom_point(
    alpha = 0.5
  ) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  geom_hline(
    yintercept = 0,
    linetype = 2,
    colour = "#404145"
  ) +
  facet_grid(
    matching_specification ~ effect_type,
    labeller = labeller(
      effect_type = label_wrap_gen(width = 12),
      matching_specification = label_wrap_gen(width = 20)
    )
  ) +
  scale_colour_manual(
    values = c("0" = "#EE4266", "1" = "#0EAD69"),
    labels = c("Comparison", "Intervention")
  ) +
  labs(
    y = "Estimated Individual Treatment Effect",
    x = "Propensity Score"
  ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

### HTE x 'Days in homelessness spell between 18th and 19th birthday'

```{r}
#| label: fig-pyi-hte-time-in-housing-support-18-19
#| fig-cap: "Heterogenous treatment effects for 'Days in homelessness spell between 18th and 19th birthday'" 
#| echo: false
#| cache: true

hte_time_in_housing_support_18_19_file_location <- "../supplementary-material/inputs/hte_time_in_housing_support_18_19_plot_data.rds"
hte_time_in_housing_support_18_19_plot_data <- readRDS(hte_time_in_housing_support_18_19_file_location)

hte_time_in_housing_support_18_19_plot_data |>
  mutate(
    effect_type = case_when(
      effect_type == "CATT x Aboriginal" ~ "CATT x Aboriginal status",
      effect_type == "CATT x Last placement: kinship care" ~ "CATT x Eligible placement: kinship care",
      effect_type == "CATT x Last placement: residential care" ~ "CATT x Eligible placement: residential care",
      TRUE ~ effect_type),
    effect_type = factor(
      effect_type,
      levels = c(
        "ATT",
        "CATT x Sex",
        "CATT x Aboriginal status",
        "CATT x Housing Vulnerability",
        "CATT x Eligible placement: residential care",
        "CATT x History of placement instability",
        "CATT x Eligible placement: kinship care"),
      ordered = TRUE)
  ) |>
  ggplot() +
  aes(
    x = distance,
    y = treatment_effect,
    colour = factor(pyi_flag)
  ) +
  geom_point(
    alpha = 0.5
  ) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  geom_hline(
    yintercept = 0,
    linetype = 2,
    colour = "#404145"
  ) +
  facet_grid(
    matching_specification ~ effect_type,
    labeller = labeller(
      effect_type = label_wrap_gen(width = 12),
      matching_specification = label_wrap_gen(width = 20)
    )
  ) +
  scale_colour_manual(
    values = c("0" = "#EE4266", "1" = "#0EAD69"),
    labels = c("Comparison", "Intervention")
  ) +
  labs(
    y = "Estimated Individual Treatment Effect",
    x = "Propensity Score"
  ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    axis.title = element_text(
      family = "roboto",
      colour = "#000000"),
    axis.text = element_text(
      family = "roboto",
      colour = "#000000"),
    legend.text = element_text(
      colour = "#000000",
      family = "roboto"),
    strip.text = element_text(
      size = rel(0.9),
      colour = "#000000",
      family = "roboto",
      face = "bold"),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    strip.background = element_blank()
  )
```

```{r}
#| echo: false

# In homelessness spell on 18th birthday                                                                  
# In homelessness spell on 19th birthday                                                                  
# New homelessness spell between 18th & 19th birthday                                                     
# Any homelessness spell between 18th & 19th birthday                                                     
# New unsheltered homelessness spell between 18th and 19th birthday                                       
# New or ongoing unsheltered homelessness spell between 18th and 19th birthday                            
# In new homelessness spell that requires short term accommodation between 18th & 19th birthday           
# In new or ongoing homelessness spell that requires short term accommodation between 18th & 19th birthday
# Number of distinct homelessness spells between 18th and 19th birthday  
# Days in homelessness spell between 18th and 19th birthday   
```

## Subgroup analysis {#sec-subgroup-analysis}

### Subgroup analysis by sex

```{r}
#| label: tbl-pyi-subgroup-analysis-sex-full-match
#| tbl-cap: "Results for subgroup analysis by sex for full matching specification" 
#| echo: false
#| cache: false

# read data
combined_subgroup_sex_results_file_location <- "../supplementary-material/inputs/combined_subgroup_sex_results.csv"
combined_subgroup_sex_results <- read_csv(
  combined_subgroup_sex_results_file_location,
  show_col_types = FALSE)

# subset and organise data
combined_subgroup_sex_results_full_match <- combined_subgroup_sex_results |>
  select(
    metrics,
    ends_with(
      "full_match")
  ) |>
  filter(
    !metrics == "Model family",
    !metrics == "Link function",
    !metrics == "Estimated Potential Outcomes:",
    !metrics == "Treatment Effects:",
    !metrics == "Risk Difference:",
    !metrics == "Relative Risk:",
    !metrics == "Odds Ratio:", 
    !metrics == "Mean Difference:",
    !metrics == "Standardised Mean Difference:",
    !metrics == "Effect moderation:"
  )

# hide column names
colnames(combined_subgroup_sex_results_full_match) <- rep("", ncol(combined_subgroup_sex_results_full_match))

# create table
combined_subgroup_sex_results_full_match |>
  tt() |>
  # specify subgroup
  group_tt(
    j = list(
      "Male" = 2,
      "Female" = 3,
      "Male" = 4,
      "Female" = 5,
      "Male" = 6,
      "Female" = 7,
      "Male" = 8,
      "Female" = 9,
      "Male" = 10,
      "Female" = 11,
      "Male" = 12,
      "Female" = 13,
      "Male" = 14,
      "Female" = 15,
      "Male" = 16,
      "Female" = 17,
      "Male" = 18,
      "Female" = 19,
      "Male" = 20,
      "Female" = 21)
    ) |>
  # add link function
  group_tt(
    j = list(
      "Link function:" = 1,
      "Logit" = 2:3,
      "Logit" = 4:5,
      "Logit" = 6:7,
      "Logit" = 8:9,
      "Logit" = 10:11,
      "Logit" = 12:13,
      "Logit" = 14:15,
      "Logit" = 16:17,
      "Log" = 18:19,
      "Identity" = 20:21)
    ) |>
  # add model family
  group_tt(
    j = list(
      "Model family:" = 1,
      "Binomial (MPL Jeffreys bias-reduced)" = 2:3,
      "Binomial (MPL Jeffreys bias-reduced)" = 4:5,
      "Binomial (MPL Jeffreys bias-reduced)" = 6:7,
      "Binomial (MPL Jeffreys bias-reduced)" = 8:9,
      "Binomial (MPL Jeffreys bias-reduced)" = 10:11,
      "Binomial (MPL Jeffreys bias-reduced)" = 12:13,
      "Binomial (MPL Jeffreys bias-reduced)" = 14:15,
      "Binomial (MPL Jeffreys bias-reduced)" = 16:17,
      "Poisson" = 18:19,
      "Linear" = 20:21)
    ) |>
  # add outcomes
  group_tt(
    j = list(
      "In homelessness spell on 18th birthday" = 2:3,                                                                  
      "In homelessness spell on 19th birthday" = 4:5,                                                                  
      "New homelessness spell between 18th & 19th birthday" = 6:7,                                                     
      "Any homelessness spell between 18th & 19th birthday" = 8:9,                                                     
      "New unsheltered homelessness spell between 18th and 19th birthday" = 10:11,                                       
      "New or ongoing unsheltered homelessness spell between 18th and 19th birthday" = 12:13,                            
      "In new homelessness spell that requires short term accommodation between 18th & 19th birthday" = 14:15,           
      "In new or ongoing homelessness spell that requires short term accommodation between 18th & 19th birthday" = 16:17,
      "Number of distinct homelessness spells between 18th and 19th birthday" = 18:19,  
      "Days in homelessness spell between 18th and 19th birthday" = 20:21)
  ) |>
  # add table subheadings
  group_tt(
    i = list(
      "Estimated Potential Outcomes:" = 1,
      "Treatment Effects:" = 3,
      "Risk Difference:" = 3,
      "Relative Risk:" = 6,
      "Odds Ratio:" = 9, 
      "Mean Difference:" = 12,
      "Standardised Mean Difference:" = 15,
      "Effect moderation:" = 18
    )
  ) |>
  # style first column of table
  style_tt(
    i = c(-3,-2,2,3,6,7,8,10,11,12,14,15,16,18,19,20,22,23,24,26,28,29,30),
    j = 1, 
    bold = FALSE,
    italic = TRUE
  ) |>
  # style table sub-headings
  style_tt(
    i = c(1,4,5,9,13,17,21,25),
    j = 1, 
    bold = TRUE,
    fontsize = 1.1,
    color = "#000000"
  ) |>
  # replace NA values with empty cells
  format_tt(
    replace = ""
  ) |>
  # align calls to centre
  style_tt(j = 2:21, align = "c") 
```

```{r}
#| label: tbl-pyi-subgroup-analysis-sex-nn-match
#| tbl-cap: "Results for subgroup analysis by sex for nearest neighbour matching specification" 
#| echo: false
#| cache: false

# read data
combined_subgroup_sex_results_file_location <- "../supplementary-material/inputs/combined_subgroup_sex_results.csv"
combined_subgroup_sex_results <- read_csv(
  combined_subgroup_sex_results_file_location,
  show_col_types = FALSE)

# subset and organise data
combined_subgroup_sex_results_nn_match <- combined_subgroup_sex_results |>
  select(
    metrics,
    ends_with(
      "nn_match")
  ) |>
  filter(
    !metrics == "Model family",
    !metrics == "Link function",
    !metrics == "Estimated Potential Outcomes:",
    !metrics == "Treatment Effects:",
    !metrics == "Risk Difference:",
    !metrics == "Relative Risk:",
    !metrics == "Odds Ratio:", 
    !metrics == "Mean Difference:",
    !metrics == "Standardised Mean Difference:",
    !metrics == "Effect moderation:"
  )

# hide column names
colnames(combined_subgroup_sex_results_nn_match) <- rep("", ncol(combined_subgroup_sex_results_nn_match))

# create table
combined_subgroup_sex_results_nn_match |>
  tt() |>
  # specify subgroup
  group_tt(
    j = list(
      "Male" = 2,
      "Female" = 3,
      "Male" = 4,
      "Female" = 5,
      "Male" = 6,
      "Female" = 7,
      "Male" = 8,
      "Female" = 9,
      "Male" = 10,
      "Female" = 11,
      "Male" = 12,
      "Female" = 13,
      "Male" = 14,
      "Female" = 15,
      "Male" = 16,
      "Female" = 17,
      "Male" = 18,
      "Female" = 19,
      "Male" = 20,
      "Female" = 21)
    ) |>
  # add link function
  group_tt(
    j = list(
      "Link function:" = 1,
      "Logit" = 2:3,
      "Logit" = 4:5,
      "Logit" = 6:7,
      "Logit" = 8:9,
      "Logit" = 10:11,
      "Logit" = 12:13,
      "Logit" = 14:15,
      "Logit" = 16:17,
      "Log" = 18:19,
      "Identity" = 20:21)
    ) |>
  # add model family
  group_tt(
    j = list(
      "Model family:" = 1,
      "Binomial (MPL Jeffreys bias-reduced)" = 2:3,
      "Binomial (MPL Jeffreys bias-reduced)" = 4:5,
      "Binomial (MPL Jeffreys bias-reduced)" = 6:7,
      "Binomial (MPL Jeffreys bias-reduced)" = 8:9,
      "Binomial (MPL Jeffreys bias-reduced)" = 10:11,
      "Binomial (MPL Jeffreys bias-reduced)" = 12:13,
      "Binomial (MPL Jeffreys bias-reduced)" = 14:15,
      "Binomial (MPL Jeffreys bias-reduced)" = 16:17,
      "Poisson" = 18:19,
      "Linear" = 20:21)
    ) |>
  # add outcomes
  group_tt(
    j = list(
      "In homelessness spell on 18th birthday" = 2:3,                                                                  
      "In homelessness spell on 19th birthday" = 4:5,                                                                  
      "New homelessness spell between 18th & 19th birthday" = 6:7,                                                     
      "Any homelessness spell between 18th & 19th birthday" = 8:9,                                                     
      "New unsheltered homelessness spell between 18th and 19th birthday" = 10:11,                                       
      "New or ongoing unsheltered homelessness spell between 18th and 19th birthday" = 12:13,                            
      "In new homelessness spell that requires short term accommodation between 18th & 19th birthday" = 14:15,           
      "In new or ongoing homelessness spell that requires short term accommodation between 18th & 19th birthday" = 16:17,
      "Number of distinct homelessness spells between 18th and 19th birthday" = 18:19,  
      "Days in homelessness spell between 18th and 19th birthday" = 20:21)
  ) |>
  # add table subheadings
  group_tt(
    i = list(
      "Estimated Potential Outcomes:" = 1,
      "Treatment Effects:" = 3,
      "Risk Difference:" = 3,
      "Relative Risk:" = 6,
      "Odds Ratio:" = 9, 
      "Mean Difference:" = 12,
      "Standardised Mean Difference:" = 15,
      "Effect moderation:" = 18
    )
  ) |>
  # style first column of table
  style_tt(
    i = c(-3,-2,2,3,6,7,8,10,11,12,14,15,16,18,19,20,22,23,24,26,28,29,30),
    j = 1, 
    bold = FALSE,
    italic = TRUE
  ) |>
  # style table sub-headings
  style_tt(
    i = c(1,4,5,9,13,17,21,25),
    j = 1, 
    bold = TRUE,
    fontsize = 1.1,
    color = "#000000"
  ) |>
  # replace NA values with empty cells
  format_tt(
    replace = ""
  ) |>
  # align calls to centre
  style_tt(j = 2:21, align = "c")  
```

### Subgroup analysis by Aboriginal and Torres Strait Islander status

```{r}
#| label: tbl-pyi-subgroup-analysis-aboriginal-full-match
#| tbl-cap: "Results for subgroup analysis by Aboriginal and Torres Strait Islander status for full matching specification" 
#| echo: false
#| cache: false

# read data
combined_subgroup_aboriginal_results_file_location <- "../supplementary-material/inputs/combined_subgroup_aboriginal_results.csv"
combined_subgroup_aboriginal_results <- read_csv(
  combined_subgroup_aboriginal_results_file_location,
  show_col_types = FALSE)

# subset and organise data
combined_subgroup_aboriginal_results_full_match <- combined_subgroup_aboriginal_results |>
  select(
    metrics,
    ends_with(
      "full_match")
  ) |>
  filter(
    !metrics == "Model family",
    !metrics == "Link function",
    !metrics == "Estimated Potential Outcomes:",
    !metrics == "Treatment Effects:",
    !metrics == "Risk Difference:",
    !metrics == "Relative Risk:",
    !metrics == "Odds Ratio:", 
    !metrics == "Mean Difference:",
    !metrics == "Standardised Mean Difference:",
    !metrics == "Effect moderation:"
  )

# hide column names
colnames(combined_subgroup_aboriginal_results_full_match) <- rep("", ncol(combined_subgroup_aboriginal_results_full_match))

# create table
combined_subgroup_aboriginal_results_full_match |>
  tt() |>
  # specify subgroup
  group_tt(
    j = list(
      "Aboriginal" = 2,
      "Non-Aboriginal" = 3,
      "Aboriginal" = 4,
      "Non-Aboriginal" = 5,
      "Aboriginal" = 6,
      "Non-Aboriginal" = 7,
      "Aboriginal" = 8,
      "Non-Aboriginal" = 9,
      "Aboriginal" = 10,
      "Non-Aboriginal" = 11,
      "Aboriginal" = 12,
      "Non-Aboriginal" = 13,
      "Aboriginal" = 14,
      "Non-Aboriginal" = 15,
      "Aboriginal" = 16,
      "Non-Aboriginal" = 17,
      "Aboriginal" = 18,
      "Non-Aboriginal" = 19,
      "Aboriginal" = 20,
      "Non-Aboriginal" = 21)
  ) |>
  # add link function
  group_tt(
    j = list(
      "Link function:" = 1,
      "Logit" = 2:3,
      "Logit" = 4:5,
      "Logit" = 6:7,
      "Logit" = 8:9,
      "Logit" = 10:11,
      "Logit" = 12:13,
      "Logit" = 14:15,
      "Logit" = 16:17,
      "Log" = 18:19,
      "Identity" = 20:21)
  ) |>
  # add model family
  group_tt(
    j = list(
      "Model family:" = 1,
      "Binomial (MPL Jeffreys bias-reduced)" = 2:3,
      "Binomial (MPL Jeffreys bias-reduced)" = 4:5,
      "Binomial (MPL Jeffreys bias-reduced)" = 6:7,
      "Binomial (MPL Jeffreys bias-reduced)" = 8:9,
      "Binomial (MPL Jeffreys bias-reduced)" = 10:11,
      "Binomial (MPL Jeffreys bias-reduced)" = 12:13,
      "Binomial (MPL Jeffreys bias-reduced)" = 14:15,
      "Binomial (MPL Jeffreys bias-reduced)" = 16:17,
      "Poisson" = 18:19,
      "Linear" = 20:21)
  ) |>
  # add outcomes
  group_tt(
    j = list(
      "In homelessness spell on 18th birthday" = 2:3,                                                                  
      "In homelessness spell on 19th birthday" = 4:5,                                                                  
      "New homelessness spell between 18th & 19th birthday" = 6:7,                                                     
      "Any homelessness spell between 18th & 19th birthday" = 8:9,                                                     
      "New unsheltered homelessness spell between 18th and 19th birthday" = 10:11,                                       
      "New or ongoing unsheltered homelessness spell between 18th and 19th birthday" = 12:13,                            
      "In new homelessness spell that requires short term accommodation between 18th & 19th birthday" = 14:15,           
      "In new or ongoing homelessness spell that requires short term accommodation between 18th & 19th birthday" = 16:17,
      "Number of distinct homelessness spells between 18th and 19th birthday" = 18:19,  
      "Days in homelessness spell between 18th and 19th birthday" = 20:21)
  ) |>
  # add table subheadings
  group_tt(
    i = list(
      "Estimated Potential Outcomes:" = 1,
      "Treatment Effects:" = 3,
      "Risk Difference:" = 3,
      "Relative Risk:" = 6,
      "Odds Ratio:" = 9, 
      "Mean Difference:" = 12,
      "Standardised Mean Difference:" = 15,
      "Effect moderation:" = 18
    )
  ) |>
  # style first column of table
  style_tt(
    i = c(-3,-2,2,3,6,7,8,10,11,12,14,15,16,18,19,20,22,23,24,26,28,29,30),
    j = 1, 
    bold = FALSE,
    italic = TRUE
  ) |>
  # style table sub-headings
  style_tt(
    i = c(1,4,5,9,13,17,21,25),
    j = 1, 
    bold = TRUE,
    fontsize = 1.1,
    color = "#000000"
  ) |>
  # replace NA values with empty cells
  format_tt(
    replace = ""
  ) |>
  # align calls to centre
  style_tt(j = 2:21, align = "c") 
```

```{r}
#| label: tbl-pyi-subgroup-analysis-aboriginal-nn-match
#| tbl-cap: "Results for subgroup analysis by Aboriginal and Torres Strait Islander status for nearest neighbour matching specification" 
#| echo: false
#| cache: false

# read data
combined_subgroup_aboriginal_results_file_location <- "../supplementary-material/inputs/combined_subgroup_aboriginal_results.csv"
combined_subgroup_aboriginal_results <- read_csv(
  combined_subgroup_aboriginal_results_file_location,
  show_col_types = FALSE)

# subset and organise data
combined_subgroup_aboriginal_results_nn_match <- combined_subgroup_aboriginal_results |>
  select(
    metrics,
    ends_with(
      "nn_match")
  ) |>
  filter(
    !metrics == "Model family",
    !metrics == "Link function",
    !metrics == "Estimated Potential Outcomes:",
    !metrics == "Treatment Effects:",
    !metrics == "Risk Difference:",
    !metrics == "Relative Risk:",
    !metrics == "Odds Ratio:", 
    !metrics == "Mean Difference:",
    !metrics == "Standardised Mean Difference:",
    !metrics == "Effect moderation:"
  )

# hide column names
colnames(combined_subgroup_aboriginal_results_nn_match) <- rep("", ncol(combined_subgroup_aboriginal_results_nn_match))

# create table
combined_subgroup_aboriginal_results_nn_match |>
  tt() |>
  # specify subgroup
  group_tt(
    j = list(
      "Aboriginal" = 2,
      "Non-Aboriginal" = 3,
      "Aboriginal" = 4,
      "Non-Aboriginal" = 5,
      "Aboriginal" = 6,
      "Non-Aboriginal" = 7,
      "Aboriginal" = 8,
      "Non-Aboriginal" = 9,
      "Aboriginal" = 10,
      "Non-Aboriginal" = 11,
      "Aboriginal" = 12,
      "Non-Aboriginal" = 13,
      "Aboriginal" = 14,
      "Non-Aboriginal" = 15,
      "Aboriginal" = 16,
      "Non-Aboriginal" = 17,
      "Aboriginal" = 18,
      "Non-Aboriginal" = 19,
      "Aboriginal" = 20,
      "Non-Aboriginal" = 21)
  ) |>
  # add link function
  group_tt(
    j = list(
      "Link function:" = 1,
      "Logit" = 2:3,
      "Logit" = 4:5,
      "Logit" = 6:7,
      "Logit" = 8:9,
      "Logit" = 10:11,
      "Logit" = 12:13,
      "Logit" = 14:15,
      "Logit" = 16:17,
      "Log" = 18:19,
      "Identity" = 20:21)
  ) |>
  # add model family
  group_tt(
    j = list(
      "Model family:" = 1,
      "Binomial (MPL Jeffreys bias-reduced)" = 2:3,
      "Binomial (MPL Jeffreys bias-reduced)" = 4:5,
      "Binomial (MPL Jeffreys bias-reduced)" = 6:7,
      "Binomial (MPL Jeffreys bias-reduced)" = 8:9,
      "Binomial (MPL Jeffreys bias-reduced)" = 10:11,
      "Binomial (MPL Jeffreys bias-reduced)" = 12:13,
      "Binomial (MPL Jeffreys bias-reduced)" = 14:15,
      "Binomial (MPL Jeffreys bias-reduced)" = 16:17,
      "Poisson" = 18:19,
      "Linear" = 20:21)
  ) |>
  # add outcomes
  group_tt(
    j = list(
      "In homelessness spell on 18th birthday" = 2:3,                                                                  
      "In homelessness spell on 19th birthday" = 4:5,                                                                  
      "New homelessness spell between 18th & 19th birthday" = 6:7,                                                     
      "Any homelessness spell between 18th & 19th birthday" = 8:9,                                                     
      "New unsheltered homelessness spell between 18th and 19th birthday" = 10:11,                                       
      "New or ongoing unsheltered homelessness spell between 18th and 19th birthday" = 12:13,                            
      "In new homelessness spell that requires short term accommodation between 18th & 19th birthday" = 14:15,           
      "In new or ongoing homelessness spell that requires short term accommodation between 18th & 19th birthday" = 16:17,
      "Number of distinct homelessness spells between 18th and 19th birthday" = 18:19,  
      "Days in homelessness spell between 18th and 19th birthday" = 20:21)
  ) |>
  # add table subheadings
  group_tt(
    i = list(
      "Estimated Potential Outcomes:" = 1,
      "Treatment Effects:" = 3,
      "Risk Difference:" = 3,
      "Relative Risk:" = 6,
      "Odds Ratio:" = 9, 
      "Mean Difference:" = 12,
      "Standardised Mean Difference:" = 15,
      "Effect moderation:" = 18
    )
  ) |>
  # style first column of table
  style_tt(
    i = c(-3,-2,2,3,6,7,8,10,11,12,14,15,16,18,19,20,22,23,24,26,28,29,30),
    j = 1, 
    bold = FALSE,
    italic = TRUE
  ) |>
  # style table sub-headings
  style_tt(
    i = c(1,4,5,9,13,17,21,25),
    j = 1, 
    bold = TRUE,
    fontsize = 1.1,
    color = "#000000"
  ) |>
  # replace NA values with empty cells
  format_tt(
    replace = ""
  ) |>
  # align calls to centre
  style_tt(j = 2:21, align = "c") 
```

### Subgroup analysis by Housing vulnerability

```{r}
#| label: tbl-pyi-subgroup-analysis-housing-vulnerability-full-match
#| tbl-cap: "Results for subgroup analysis by housing vulnerability for full matching specification" 
#| echo: false
#| cache: false

# read data
combined_subgroup_housing_vulnerability_results_file_location <- "../supplementary-material/inputs/combined_subgroup_housing_vulnerability_results.csv"
combined_subgroup_housing_vulnerability_results <- read_csv(
  combined_subgroup_housing_vulnerability_results_file_location,
  show_col_types = FALSE)

# subset and organise data
combined_subgroup_housing_vulnerability_results_full_match <- combined_subgroup_housing_vulnerability_results |>
  select(
    metrics,
    ends_with(
      "full_match")
  ) |>
  filter(
    !metrics == "Model family",
    !metrics == "Link function",
    !metrics == "Estimated Potential Outcomes:",
    !metrics == "Treatment Effects:",
    !metrics == "Risk Difference:",
    !metrics == "Relative Risk:",
    !metrics == "Odds Ratio:", 
    !metrics == "Mean Difference:",
    !metrics == "Standardised Mean Difference:",
    !metrics == "Effect moderation:"
  )

# hide column names
colnames(combined_subgroup_housing_vulnerability_results_full_match) <- rep("", ncol(combined_subgroup_housing_vulnerability_results_full_match))

# create table
combined_subgroup_housing_vulnerability_results_full_match |>
  tt() |>
  # specify subgroup
  group_tt(
    j = list(
      "Homeless before 18" = 2,
      "Not homeless before 18" = 3,
      "Homeless before 18" = 4,
      "Not homeless before 18" = 5,
      "Homeless before 18" = 6,
      "Not homeless before 18" = 7,
      "Homeless before 18" = 8,
      "Not homeless before 18" = 9,
      "Homeless before 18" = 10,
      "Not homeless before 18" = 11,
      "Homeless before 18" = 12,
      "Not homeless before 18" = 13,
      "Homeless before 18" = 14,
      "Not homeless before 18" = 15,
      "Homeless before 18" = 16,
      "Not homeless before 18" = 17,
      "Homeless before 18" = 18,
      "Not homeless before 18" = 19,
      "Homeless before 18" = 20,
      "Not homeless before 18" = 21)
  ) |>
  # add link function
  group_tt(
    j = list(
      "Link function:" = 1,
      "Logit" = 2:3,
      "Logit" = 4:5,
      "Logit" = 6:7,
      "Logit" = 8:9,
      "Logit" = 10:11,
      "Logit" = 12:13,
      "Logit" = 14:15,
      "Logit" = 16:17,
      "Log" = 18:19,
      "Identity" = 20:21)
  ) |>
  # add model family
  group_tt(
    j = list(
      "Model family:" = 1,
      "Binomial (MPL Jeffreys bias-reduced)" = 2:3,
      "Binomial (MPL Jeffreys bias-reduced)" = 4:5,
      "Binomial (MPL Jeffreys bias-reduced)" = 6:7,
      "Binomial (MPL Jeffreys bias-reduced)" = 8:9,
      "Binomial (MPL Jeffreys bias-reduced)" = 10:11,
      "Binomial (MPL Jeffreys bias-reduced)" = 12:13,
      "Binomial (MPL Jeffreys bias-reduced)" = 14:15,
      "Binomial (MPL Jeffreys bias-reduced)" = 16:17,
      "Poisson" = 18:19,
      "Linear" = 20:21)
  ) |>
  # add outcomes
  group_tt(
    j = list(
      "In homelessness spell on 18th birthday" = 2:3,                                                                  
      "In homelessness spell on 19th birthday" = 4:5,                                                                  
      "New homelessness spell between 18th & 19th birthday" = 6:7,                                                     
      "Any homelessness spell between 18th & 19th birthday" = 8:9,                                                     
      "New unsheltered homelessness spell between 18th and 19th birthday" = 10:11,                                       
      "New or ongoing unsheltered homelessness spell between 18th and 19th birthday" = 12:13,                            
      "In new homelessness spell that requires short term accommodation between 18th & 19th birthday" = 14:15,           
      "In new or ongoing homelessness spell that requires short term accommodation between 18th & 19th birthday" = 16:17,
      "Number of distinct homelessness spells between 18th and 19th birthday" = 18:19,  
      "Days in homelessness spell between 18th and 19th birthday" = 20:21)
  ) |>
  # add table subheadings
  group_tt(
    i = list(
      "Estimated Potential Outcomes:" = 1,
      "Treatment Effects:" = 3,
      "Risk Difference:" = 3,
      "Relative Risk:" = 6,
      "Odds Ratio:" = 9, 
      "Mean Difference:" = 12,
      "Standardised Mean Difference:" = 15,
      "Effect moderation:" = 18
    )
  ) |>
  # style first column of table
  style_tt(
    i = c(-3,-2,2,3,6,7,8,10,11,12,14,15,16,18,19,20,22,23,24,26,28,29,30),
    j = 1, 
    bold = FALSE,
    italic = TRUE
  ) |>
  # style table sub-headings
  style_tt(
    i = c(1,4,5,9,13,17,21,25),
    j = 1, 
    bold = TRUE,
    fontsize = 1.1,
    color = "#000000"
  ) |>
  # replace NA values with empty cells
  format_tt(
    replace = ""
  ) |>
  # align calls to centre
  style_tt(j = 2:21, align = "c") 
```

```{r}
#| label: tbl-pyi-subgroup-analysis-housing-vulnerability-nn-match
#| tbl-cap: "Results for subgroup analysis by housing vulnerability for nearest neighbour matching specification" 
#| echo: false
#| cache: false

# read data
combined_subgroup_housing_vulnerability_results_file_location <- "../supplementary-material/inputs/combined_subgroup_housing_vulnerability_results.csv"
combined_subgroup_housing_vulnerability_results <- read_csv(
  combined_subgroup_housing_vulnerability_results_file_location,
  show_col_types = FALSE)

# subset and organise data
combined_subgroup_housing_vulnerability_results_nn_match <- combined_subgroup_housing_vulnerability_results |>
  select(
    metrics,
    ends_with(
      "nn_match")
  ) |>
  filter(
    !metrics == "Model family",
    !metrics == "Link function",
    !metrics == "Estimated Potential Outcomes:",
    !metrics == "Treatment Effects:",
    !metrics == "Risk Difference:",
    !metrics == "Relative Risk:",
    !metrics == "Odds Ratio:", 
    !metrics == "Mean Difference:",
    !metrics == "Standardised Mean Difference:",
    !metrics == "Effect moderation:"
  )

# hide column names
colnames(combined_subgroup_housing_vulnerability_results_nn_match) <- rep("", ncol(combined_subgroup_housing_vulnerability_results_nn_match))

# create table
combined_subgroup_housing_vulnerability_results_nn_match |>
  tt() |>
  # specify subgroup
  group_tt(
    j = list(
      "Homeless before 18" = 2,
      "Not homeless before 18" = 3,
      "Homeless before 18" = 4,
      "Not homeless before 18" = 5,
      "Homeless before 18" = 6,
      "Not homeless before 18" = 7,
      "Homeless before 18" = 8,
      "Not homeless before 18" = 9,
      "Homeless before 18" = 10,
      "Not homeless before 18" = 11,
      "Homeless before 18" = 12,
      "Not homeless before 18" = 13,
      "Homeless before 18" = 14,
      "Not homeless before 18" = 15,
      "Homeless before 18" = 16,
      "Not homeless before 18" = 17,
      "Homeless before 18" = 18,
      "Not homeless before 18" = 19,
      "Homeless before 18" = 20,
      "Not homeless before 18" = 21)
  ) |>
  # add link function
  group_tt(
    j = list(
      "Link function:" = 1,
      "Logit" = 2:3,
      "Logit" = 4:5,
      "Logit" = 6:7,
      "Logit" = 8:9,
      "Logit" = 10:11,
      "Logit" = 12:13,
      "Logit" = 14:15,
      "Logit" = 16:17,
      "Log" = 18:19,
      "Identity" = 20:21)
  ) |>
  # add model family
  group_tt(
    j = list(
      "Model family:" = 1,
      "Binomial (MPL Jeffreys bias-reduced)" = 2:3,
      "Binomial (MPL Jeffreys bias-reduced)" = 4:5,
      "Binomial (MPL Jeffreys bias-reduced)" = 6:7,
      "Binomial (MPL Jeffreys bias-reduced)" = 8:9,
      "Binomial (MPL Jeffreys bias-reduced)" = 10:11,
      "Binomial (MPL Jeffreys bias-reduced)" = 12:13,
      "Binomial (MPL Jeffreys bias-reduced)" = 14:15,
      "Binomial (MPL Jeffreys bias-reduced)" = 16:17,
      "Poisson" = 18:19,
      "Linear" = 20:21)
  ) |>
  # add outcomes
  group_tt(
    j = list(
      "In homelessness spell on 18th birthday" = 2:3,                                                                  
      "In homelessness spell on 19th birthday" = 4:5,                                                                  
      "New homelessness spell between 18th & 19th birthday" = 6:7,                                                     
      "Any homelessness spell between 18th & 19th birthday" = 8:9,                                                     
      "New unsheltered homelessness spell between 18th and 19th birthday" = 10:11,                                       
      "New or ongoing unsheltered homelessness spell between 18th and 19th birthday" = 12:13,                            
      "In new homelessness spell that requires short term accommodation between 18th & 19th birthday" = 14:15,           
      "In new or ongoing homelessness spell that requires short term accommodation between 18th & 19th birthday" = 16:17,
      "Number of distinct homelessness spells between 18th and 19th birthday" = 18:19,  
      "Days in homelessness spell between 18th and 19th birthday" = 20:21)
  ) |>
  # add table subheadings
  group_tt(
    i = list(
      "Estimated Potential Outcomes:" = 1,
      "Treatment Effects:" = 3,
      "Risk Difference:" = 3,
      "Relative Risk:" = 6,
      "Odds Ratio:" = 9, 
      "Mean Difference:" = 12,
      "Standardised Mean Difference:" = 15,
      "Effect moderation:" = 18
    )
  ) |>
  # style first column of table
  style_tt(
    i = c(-3,-2,2,3,6,7,8,10,11,12,14,15,16,18,19,20,22,23,24,26,28,29,30),
    j = 1, 
    bold = FALSE,
    italic = TRUE
  ) |>
  # style table sub-headings
  style_tt(
    i = c(1,4,5,9,13,17,21,25),
    j = 1, 
    bold = TRUE,
    fontsize = 1.1,
    color = "#000000"
  ) |>
  # replace NA values with empty cells
  format_tt(
    replace = ""
  ) |>
  # align calls to centre
  style_tt(j = 2:21, align = "c")
```

## Sensitivity analysis {#sec-sensitivity-analysis}

```{r}
#| label: tbl-pyi-sensitivity-analysis-tip
#| tbl-cap: "Results for sensitivity analysis" 
#| echo: false
#| cache: false

sensitivity_analysis_results_location <- "../supplementary-material/inputs/combined_tip_analysis_results.csv"
sensitivity_analysis_results <- read_csv(
  sensitivity_analysis_results_location,
  show_col_types = FALSE)

sensitivity_analysis_results |>
  rename(
    Outcome = outcome,
    `Matching Specification` = matching_specification,
    Scenario = scenario,
    `Assumed prevalence of confounder in treatment group` = confounder_prevalence_exposed,
    `Assumed prevalence of confounder in comparison group` = confounder_prevalence_unexposed,
    `Confounder outcome relationship` = confounder_outcome_relationship
  ) |>
  tt() |>
  style_tt(
    i = c(1, 7, 13, 19, 25, 31, 37, 43, 49, 55), 
    j = 1,
    rowspan = 6,
    alignv = "t"
  ) |>  
  style_tt(
    i = c(1, 4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 34, 37, 40, 43, 46, 49, 52, 55),
    j = 2,
    rowspan = 3,
    alignv = "t"
  ) |>
  format_tt(
    digits = 2, 
    num_fmt = "significant_cell"
  ) |>
  style_tt(
    i = c(4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 34, 37, 40, 43, 46, 49, 52, 55), 
    line = "t", 
    line_color = "#000000", 
    line_width = 0.1
    ) 

```

<h1>References</h1>

::: {#refs}
:::
